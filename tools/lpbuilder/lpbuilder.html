<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LP Builder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <link rel="stylesheet" href="/tools/lpbuilder/lpbuilder.css">
</head>
<body>
    <div class="lpbuilder-app">
        <!-- ヘッダー -->
        <header class="lpbuilder-header">
            <div class="header-left">
                <button class="back-btn js-back-btn" title="戻る">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5"/>
                        <polyline points="12 19 5 12 12 5"/>
                    </svg>
                </button>
                <span class="header-title">LP Builder</span>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary js-template-btn" title="テンプレート">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    テンプレ
                </button>
                <button class="btn btn-secondary js-export-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    ZIP出力
                </button>
                <button class="btn btn-primary js-save-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    保存
                </button>
            </div>
        </header>

        <!-- プロジェクトタブバー -->
        <div class="project-tabs js-project-tabs">
            <div class="project-tab-list js-project-tab-list">
                <!-- タブはJSで動的に生成 -->
            </div>
            <button class="project-tab-add js-add-tab" title="新規タブ">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
            </button>
        </div>

        <!-- メインコンテンツ -->
        <div class="lpbuilder-main">
            <!-- 左側: エディタエリア（3分割） -->
            <div class="editors-area js-editors-area">
                <button class="editors-toggle-btn js-editors-toggle" title="コードエディタ開閉">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"/>
                    </svg>
                </button>
                
                <!-- エディタタブバー -->
                <div class="editor-tabs">
                    <button class="editor-tab js-editor-tab active" data-tab="html">HTML</button>
                    <button class="editor-tab js-editor-tab" data-tab="css">CSS</button>
                    <button class="editor-tab js-editor-tab" data-tab="js">JS</button>
                    <button class="editor-tab js-editor-tab" data-tab="images">画像</button>
                </div>
                
                <!-- エディタコンテンツ -->
                <div class="editor-content">
                    <!-- HTMLエディタ -->
                    <div class="editor-panel js-editor-panel active" data-panel="html">
                        <div class="editor-wrapper">
                            <textarea class="editor-textarea js-editor-html"></textarea>
                        </div>
                    </div>
                    
                    <!-- CSSエディタ -->
                    <div class="editor-panel js-editor-panel" data-panel="css">
                        <div class="editor-wrapper">
                            <textarea class="editor-textarea js-editor-css"></textarea>
                        </div>
                    </div>
                    
                    <!-- JSエディタ -->
                    <div class="editor-panel js-editor-panel" data-panel="js">
                        <div class="editor-wrapper">
                            <textarea class="editor-textarea js-editor-js"></textarea>
                        </div>
                    </div>
                    
                    <!-- 画像パネル -->
                    <div class="editor-panel js-editor-panel" data-panel="images">
                        <div class="images-panel">
                            <div class="images-header">
                                <button class="images-add-btn js-images-add-btn" title="画像を追加">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"/>
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                    </svg>
                                    画像を追加
                                </button>
                            </div>
                            <div class="images-wrapper js-images-wrapper">
                                <div class="images-dropzone js-images-dropzone">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21 15 16 10 5 21"/>
                                    </svg>
                                    <span>ドラッグ&ドロップ</span>
                                    <span>または クリックで追加</span>
                                </div>
                                <div class="images-grid js-images-grid">
                                    <!-- 画像サムネイルはJSで動的に生成 -->
                                </div>
                            </div>
                            <input type="file" class="images-file-input js-images-file-input" accept="image/*" multiple style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 部分選択修正パネル（フローティング） -->
            <div class="selection-panel js-selection-panel" style="display: none;">
                <div class="selection-panel-header">
                    <span>選択コードを修正</span>
                    <button class="selection-panel-close js-selection-panel-close">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="selection-preview js-selection-preview"></div>
                <textarea class="selection-input js-selection-input" placeholder="修正指示を入力...（例：色を青に変更）" rows="2"></textarea>
                <div class="selection-panel-actions">
                    <button class="selection-action-btn js-selection-modify">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                        修正
                    </button>
                    <button class="selection-action-btn js-selection-image">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                        画像生成
                    </button>
                </div>
            </div>
            
            <!-- 中央: プレビューエリア -->
            <div class="preview-area">
                <div class="preview-header">
                    <span class="preview-title">プレビュー</span>
                    <div class="preview-controls">
                        <div class="preview-mode-toggle">
                            <button class="preview-mode-btn active js-preview-mode-btn" data-mode="mobile" title="スマホ表示">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                                    <line x1="12" y1="18" x2="12.01" y2="18"/>
                                </svg>
                            </button>
                            <button class="preview-mode-btn js-preview-mode-btn" data-mode="desktop" title="PC表示">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                    <line x1="8" y1="21" x2="16" y2="21"/>
                                    <line x1="12" y1="17" x2="12" y2="21"/>
                                </svg>
                            </button>
                        </div>
                        <button class="action-btn js-refresh-btn" title="プレビュー更新">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"/>
                                <polyline points="1 20 1 14 7 14"/>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="preview-wrapper js-preview-wrapper" data-mode="mobile">
                    <!-- スマホモード -->
                    <div class="smartphone-frame js-smartphone-frame">
                        <div class="smartphone-notch"></div>
                        <div class="smartphone-screen">
                            <iframe class="preview-iframe js-preview-iframe" sandbox="allow-scripts allow-same-origin"></iframe>
                        </div>
                        <div class="smartphone-home-indicator"></div>
                    </div>
                    <!-- PCモード -->
                    <div class="desktop-frame js-desktop-frame" style="display: none;">
                        <iframe class="preview-iframe-desktop js-preview-iframe-desktop" sandbox="allow-scripts allow-same-origin"></iframe>
                    </div>
                </div>
                
                <!-- プレビューツールバー -->
                <div class="preview-toolbar">
                    <button class="preview-tool-btn js-preview-select-btn" title="選択修正モード">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                        <span>選択修正</span>
                    </button>
                    <button class="preview-tool-btn js-preview-image-btn" title="画像生成">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                        <span>画像生成</span>
                    </button>
                </div>
                
                <!-- 選択修正パネル（プレビュー下部） -->
                <div class="preview-edit-panel js-preview-edit-panel" style="display: none;">
                    <div class="preview-edit-header">
                        <span class="preview-edit-title">選択範囲を修正</span>
                        <button class="preview-edit-close js-preview-edit-close">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>
                    <div class="preview-edit-selected js-preview-edit-selected">選択されたテキスト</div>
                    <textarea class="preview-edit-input js-preview-edit-input" placeholder="修正指示を入力...（例：色を青に変更）" rows="2"></textarea>
                    <div class="preview-edit-actions">
                        <button class="preview-edit-btn primary js-preview-edit-apply">修正を適用</button>
                    </div>
                </div>
            </div>

            <!-- 右パネル: AIチャット -->
            <aside class="right-panel js-right-panel">
                <button class="panel-toggle-btn right js-right-panel-toggle" title="パネル開閉">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <div class="panel-content">
                    <!-- AIアシスタントセクション -->
                    <div class="ai-chat-section">
                        <div class="panel-header">
                            <h2>AIアシスタント</h2>
                            <button class="clear-chat-btn js-clear-chat" title="チャット履歴をクリア">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </div>
                    <div class="chat-messages js-chat-messages">
                        <div class="chat-message assistant">
                            <div class="message-avatar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"/>
                                    <path d="M12 16v-4"/>
                                    <path d="M12 8h.01"/>
                                </svg>
                            </div>
                            <div class="message-content">
                                <p>こんにちは！LP作成をサポートします。どんなLPを作りたいですか？</p>
                                <ul>
                                    <li>業種（例：美容、飲食、不動産）</li>
                                    <li>目的（例：資料請求、予約獲得）</li>
                                    <li>ターゲット（例：20代女性）</li>
                                </ul>
                                <p>を教えていただけると、最適なLPを提案できます。</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <textarea class="chat-input js-chat-input" placeholder="メッセージを入力..." rows="1"></textarea>
                        <button class="chat-send-btn js-chat-send">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"/>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                            </svg>
                        </button>
                    </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- プロジェクト選択モーダル -->
    <div class="modal-overlay js-project-modal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>プロジェクト選択</h3>
                <button class="modal-close-btn js-modal-close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-content">
                <div class="new-project-section">
                    <button class="new-project-btn js-new-project">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        新規LPを作成
                    </button>
                    <button class="new-project-btn js-template-select" style="margin-top: 8px; border-color: var(--color-primary); color: var(--color-primary);">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        テンプレートから作成
                    </button>
                </div>
                <div class="project-list js-project-list">
                    <!-- プロジェクト一覧が動的に追加される -->
                </div>
            </div>
        </div>
    </div>

    <!-- 差分表示モーダル -->
    <div class="modal-overlay js-diff-modal" style="display: none;">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3>コード変更の確認</h3>
                <button class="modal-close-btn js-diff-modal-close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-content">
                <div class="diff-tabs">
                    <button class="diff-tab-btn active" data-diff-tab="html">HTML</button>
                    <button class="diff-tab-btn" data-diff-tab="css">CSS</button>
                    <button class="diff-tab-btn" data-diff-tab="js">JS</button>
                </div>
                <div class="diff-content js-diff-content" style="max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; background: #282a36; padding: 16px; border-radius: 8px;">
                    <!-- 差分が動的に表示される -->
                </div>
                <p class="diff-message js-diff-message" style="margin-top: 16px; color: var(--color-gray-600);"></p>
            </div>
            <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 16px 24px; border-top: 1px solid var(--border-color);">
                <button class="btn btn-secondary js-diff-cancel">キャンセル</button>
                <button class="btn btn-primary js-diff-apply">変更を適用</button>
            </div>
        </div>
    </div>

    <!-- 画像生成モーダル -->
    <div class="modal-overlay js-image-modal" style="display: none;">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3>画像生成</h3>
                <button class="modal-close-btn js-image-modal-close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-content">
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 500;">プロンプト</label>
                    <textarea class="js-image-prompt" placeholder="生成したい画像の説明（例：青空の下でジョギングする女性）" rows="3" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; resize: vertical;"></textarea>
                </div>
                <div class="form-row" style="display: flex; gap: 12px;">
                    <div class="form-group" style="flex: 1;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 500;">幅 (px)</label>
                        <input type="number" class="js-image-width" value="1024" min="256" max="2048" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 500;">高さ (px)</label>
                        <input type="number" class="js-image-height" value="768" min="256" max="2048" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                </div>
                <div class="image-preview js-image-preview" style="margin-top: 16px; display: none;">
                    <img src="" alt="生成画像" style="max-width: 100%; border-radius: 8px;">
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 16px 24px; border-top: 1px solid var(--border-color);">
                <button class="btn btn-secondary js-image-cancel">キャンセル</button>
                <button class="btn btn-primary js-image-generate">生成</button>
                <button class="btn btn-primary js-image-insert" style="display: none;">LPに挿入</button>
            </div>
        </div>
    </div>

    <!-- テンプレートモーダル -->
    <div class="modal-overlay js-template-modal" style="display: none;">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3>テンプレート管理</h3>
                <button class="modal-close-btn js-template-modal-close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-content">
                <div class="template-save-section" style="margin-bottom: 24px; padding: 16px; background: var(--color-gray-50); border-radius: 8px;">
                    <h4 style="margin-bottom: 12px; font-size: 14px;">現在のコードをテンプレートとして保存</h4>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" class="js-template-name" placeholder="テンプレート名" style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                        <button class="btn btn-primary js-template-save">保存</button>
                    </div>
                </div>
                <div class="template-list-section">
                    <h4 style="margin-bottom: 12px; font-size: 14px;">保存済みテンプレート</h4>
                    <div class="template-list js-template-list">
                        <!-- テンプレート一覧が動的に追加される -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- トースト通知 -->
    <div class="toast-container js-toast-container"></div>

    <!-- 外部ライブラリ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="/tools/lpbuilder/tabManager.js"></script>
    <script src="/tools/lpbuilder/lpbuilder.js"></script>
</body>
</html>
