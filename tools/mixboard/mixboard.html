<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mixboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/tools/mixboard/mixboard.css">
</head>
<body>
    <div class="mixboard-app">
        <!-- ヘッダー -->
        <header class="mixboard-header">
            <div class="header-left">
                <button class="back-btn" id="backBtn" title="戻る">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5"/>
                        <polyline points="12 19 5 12 12 5"/>
                    </svg>
                </button>
                <input type="text" class="project-name-input" id="projectName" value="Untitled">
                <button class="icon-btn" id="fullscreenBtn" title="フルスクリーン">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15,3 21,3 21,9"/>
                        <polyline points="9,21 3,21 3,15"/>
                        <line x1="21" y1="3" x2="14" y2="10"/>
                        <line x1="3" y1="21" x2="10" y2="14"/>
                    </svg>
                </button>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" id="shareBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                    Share
                </button>
                <button class="btn btn-primary" id="transformBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    Transform
                </button>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <div class="mixboard-main">
            <!-- 左パネル: 参考デザイン（折りたたみ可） -->
            <aside class="left-panel collapsed" id="leftPanel">
                <div class="panel-content">
                    <div class="panel-header">
                        <h2>参考デザイン</h2>
                        <button class="add-btn" id="addReferenceBtn" title="追加">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                        </button>
                    </div>
                    <div class="panel-select">
                        <select id="categorySelect">
                            <option value="all">すべて</option>
                            <option value="debt">債務整理</option>
                            <option value="clinic">クリニック</option>
                        </select>
                    </div>
                    <div class="reference-list" id="referenceList"></div>
                </div>
                <button class="panel-toggle-btn left" id="leftPanelToggle" title="パネル開閉">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9,18 15,12 9,6"/>
                    </svg>
                </button>
            </aside>

            <!-- 中央: キャンバスエリア -->
            <div class="canvas-area" id="canvasArea">
                <!-- 左サイドツールバー -->
                <div class="left-toolbar" id="leftToolbar">
                    <button class="tool-btn active" id="toolSelect" title="選択ツール" data-tool="select">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" id="toolHand" title="ハンドツール" data-tool="hand">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 11V6a2 2 0 0 0-2-2 2 2 0 0 0-2 2v5"/>
                            <path d="M14 10V4a2 2 0 0 0-2-2 2 2 0 0 0-2 2v6"/>
                            <path d="M10 10.5V6a2 2 0 0 0-2-2 2 2 0 0 0-2 2v8"/>
                            <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8H9a8 8 0 0 1-8-8V8a2 2 0 1 1 4 0"/>
                        </svg>
                    </button>
                    <button class="tool-btn" id="toolText" title="テキストツール" data-tool="text">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="4,7 4,4 20,4 20,7"/>
                            <line x1="9" y1="20" x2="15" y2="20"/>
                            <line x1="12" y1="4" x2="12" y2="20"/>
                        </svg>
                    </button>
                </div>

                <!-- キャンバスコンテナ -->
                <div class="canvas-wrapper" id="canvasWrapper">
                    <div class="canvas-container" id="canvasContainer">
                        <div class="canvas-empty-state" id="canvasEmptyState">
                            <span class="empty-text">Add your text</span>
                        </div>
                        <!-- 範囲選択矩形 -->
                        <div class="selection-box" id="selectionBox" style="display: none;"></div>
                    </div>
                </div>

                <!-- 画像選択時フローティングツールバー -->
                <div class="element-toolbar" id="elementToolbar" style="display: none;">
                    <button class="element-tool-btn" id="btnRefresh" title="再生成">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                    </button>
                    <button class="element-tool-btn" id="btnEdit" title="編集">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </button>
                    <button class="element-tool-btn" id="btnDuplicate" title="複製">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                    </button>
                    <button class="element-tool-btn" id="btnDownload" title="ダウンロード">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                    <button class="element-tool-btn delete" id="btnDelete" title="削除">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </button>
                </div>

                <!-- テキスト編集ツールバー -->
                <div class="text-toolbar" id="textToolbar" style="display: none;">
                    <button class="color-picker-btn" id="textColorBtn" title="テキストカラー">
                        <span class="color-indicator" style="background: #6366f1;"></span>
                    </button>
                    <input type="color" id="textColorInput" value="#6366f1" style="display: none;">
                    <select class="font-select" id="fontSelect">
                        <option value="sans-serif">Sans-Serif</option>
                        <option value="serif">Serif</option>
                        <option value="monospace">Monospace</option>
                    </select>
                    <button class="text-size-btn" id="fontSizeDown">−</button>
                    <span class="font-size-display" id="fontSizeDisplay">28</span>
                    <button class="text-size-btn" id="fontSizeUp">+</button>
                    <button class="text-style-btn" id="boldBtn" title="太字"><b>B</b></button>
                    <button class="text-style-btn" id="italicBtn" title="斜体"><i>I</i></button>
                    <button class="text-style-btn" id="underlineBtn" title="下線"><u>U</u></button>
                    <div class="toolbar-divider"></div>
                    <button class="text-style-btn delete" id="textDeleteBtn" title="削除">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </button>
                </div>

                <!-- 下部チャットバー（画像生成AI用） -->
                <div class="bottom-chat-container" id="bottomChatContainer">
                    <!-- 選択画像プレビュー（入力バーの上に表示） -->
                    <div class="selected-image-preview-bar" id="selectedImagePreviewBar" style="display: none;">
                        <div class="preview-content">
                            <div class="preview-thumbnails" id="previewThumbnails">
                                <!-- 動的にサムネイルが追加される -->
                            </div>
                            <span class="preview-label" id="previewLabel">選択中</span>
                            <button class="preview-close-btn" id="previewCloseBtn" title="選択解除">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 設定パネル -->
                    <div class="generator-settings-panel" id="generatorSettingsPanel" style="display: none;">
                        <div class="settings-header">
                            <span class="settings-title">生成画像サイズ</span>
                            <button class="settings-close-btn" id="settingsCloseBtn" title="閉じる">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="settings-content">
                            <div class="size-presets">
                                <button class="size-preset-btn active" data-width="512" data-height="512">512×512</button>
                                <button class="size-preset-btn" data-width="768" data-height="768">768×768</button>
                                <button class="size-preset-btn" data-width="1024" data-height="1024">1024×1024</button>
                                <button class="size-preset-btn" data-width="1024" data-height="768">1024×768</button>
                                <button class="size-preset-btn" data-width="768" data-height="1024">768×1024</button>
                            </div>
                            <div class="custom-size">
                                <label>カスタムサイズ</label>
                                <div class="custom-size-inputs">
                                    <input type="number" id="customWidthInput" placeholder="幅" min="256" max="2048" step="64">
                                    <span>×</span>
                                    <input type="number" id="customHeightInput" placeholder="高さ" min="256" max="2048" step="64">
                                    <button class="apply-custom-btn" id="applyCustomSizeBtn">適用</button>
                                </div>
                            </div>
                            <div class="current-size-display">
                                現在: <strong id="currentSizeDisplay">512×512</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- チャットバー本体 -->
                    <div class="bottom-chat-bar" id="bottomChatBar">
                        <button class="chat-plus-btn" id="chatPlusBtn" title="画像追加">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                        </button>
                        <div class="chat-input-wrapper">
                            <button class="settings-btn" id="settingsBtn" title="設定">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="4" y1="21" x2="4" y2="14"/>
                                    <line x1="4" y1="10" x2="4" y2="3"/>
                                    <line x1="12" y1="21" x2="12" y2="12"/>
                                    <line x1="12" y1="8" x2="12" y2="3"/>
                                    <line x1="20" y1="21" x2="20" y2="16"/>
                                    <line x1="20" y1="12" x2="20" y2="3"/>
                                    <line x1="1" y1="14" x2="7" y2="14"/>
                                    <line x1="9" y1="8" x2="15" y2="8"/>
                                    <line x1="17" y1="16" x2="23" y2="16"/>
                                </svg>
                            </button>
                            <input type="text" class="chat-input" id="generatorInput" placeholder="What do you want to create?">
                            <button class="chat-send-btn" id="generatorSendBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 16 16 12 12 8"/>
                                    <line x1="8" y1="12" x2="16" y2="12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ズームコントロール -->
                <div class="zoom-controls" id="zoomControls">
                    <button class="zoom-btn" id="zoomOut" title="縮小">−</button>
                    <span class="zoom-level" id="zoomLevel">100%</span>
                    <button class="zoom-btn" id="zoomIn" title="拡大">+</button>
                    <button class="zoom-btn help" id="helpBtn" title="ヘルプ">?</button>
                </div>
            </div>

            <!-- 右パネル: 対話AIチャット（折りたたみ可） -->
            <aside class="right-panel collapsed" id="rightPanel">
                <button class="panel-toggle-btn right" id="rightPanelToggle" title="パネル開閉">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15,18 9,12 15,6"/>
                    </svg>
                </button>
                <div class="panel-content">
                    <div class="panel-header">
                        <h2>AIチャット</h2>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message assistant">
                            <div class="message-content">
                                <p>AIアシスタントです。何を作りますか？</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput" placeholder="メッセージを入力...">
                        <button class="chat-send-btn" id="chatSendBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"/>
                                <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- 修正モードオーバーレイ -->
    <div class="revision-overlay" id="revisionOverlay" style="display: none;">
        <div class="revision-container">
            <div class="revision-header">
                <h3>画像編集</h3>
                <button class="cancel-btn" id="revisionCancelBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    キャンセル
                </button>
            </div>
            <div class="revision-content">
                <div class="revision-image-wrapper" id="revisionImageWrapper">
                    <img id="revisionImage" src="" alt="編集中">
                    <div class="revision-layer" id="revisionLayer"></div>
                </div>
            </div>
            <div class="revision-tools">
                <div class="color-palette">
                    <button class="palette-btn active" data-color="red" style="background: #ff4d4d;"></button>
                    <button class="palette-btn" data-color="green" style="background: #22c55e;"></button>
                    <button class="palette-btn" data-color="blue" style="background: #3b82f6;"></button>
                    <button class="palette-btn" data-color="yellow" style="background: #eab308;"></button>
                </div>
            </div>
            <div class="revision-footer">
                <button class="btn btn-secondary" id="revisionCancelBtn2">キャンセル</button>
                <button class="btn btn-primary" id="revisionSaveBtn">保存</button>
            </div>
        </div>
    </div>

    <script src="/tools/mixboard/mixboard.js"></script>
</body>
</html>
